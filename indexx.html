<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Ù†Ù…Ø§ÛŒØ´Ú¯Ø± Ù…Ø¯Ù„ Ø³Ù‡â€ŒØ¨Ø¹Ø¯ÛŒ Ùˆ ÙˆØ§Ù‚Ø¹ÛŒØª Ø§ÙØ²ÙˆØ¯Ù‡</title>

  <!-- Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ -->
  <script type="module" src="model-viewer.min.js"></script>
  <script nomodule src="model-viewer-legacy.js"></script>
  
  <!-- Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒØª Ø§ÙØ²ÙˆØ¯Ù‡ -->
  <script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.0/dist/mindar-image-aframe.prod.js"></script>

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">

  <style>
    body {
      margin: 0;
      background-color: #f8f8f8;
      direction: rtl;
      font-family: sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      touch-action: manipulation; /* Ø¨Ù‡Ø¨ÙˆØ¯ Ø±ÙØªØ§Ø± Ù„Ù…Ø³ÛŒ */
    }

    .container {
      width: 100%;
      max-width: 854px;
      aspect-ratio: 854 / 480;
      position: relative;
      -webkit-tap-highlight-color: transparent; /* Ø­Ø°Ù Ù‡Ø§ÛŒÙ„Ø§ÛŒØª Ù„Ù…Ø³ÛŒ Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ */
    }

    model-viewer {
      width: 100%;
      height: 100%;
      background-color: var(--model-bg-color, #fff);
      border-radius: 8px;
      transition: background-color 0.3s ease;
      touch-action: pan-x pan-y; /* Ø¨Ù‡Ø¨ÙˆØ¯ Ø­Ø±Ú©Ø§Øª Ù„Ù…Ø³ÛŒ */
    }

    #progress-slider {
      position: absolute;
      bottom: 64px;
      left: 0;
      right: 0;
      margin: 0 20px;
      height: 6px;
      appearance: none;
      background: #ccc;
      border-radius: 4px;
      z-index: 9;
      accent-color: #007bff;
      direction: ltr;
      transition: opacity 0.5s ease;
      opacity: 1;
    }

    #progress-slider.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .control-buttons {
      position: absolute;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 12px;
      z-index: 10;
      transition: opacity 0.5s ease;
      opacity: 1;
    }

    .control-buttons.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .animation-controls.hidden {
      display: none !important;
    }

    .icon-button {
      width: 48px;
      height: 48px;
      background-color: transparent;
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background-color 0.3s, box-shadow 0.3s;
      -webkit-tap-highlight-color: transparent; /* Ø­Ø°Ù Ù‡Ø§ÛŒÙ„Ø§ÛŒØª Ù„Ù…Ø³ÛŒ */
    }

    .icon-button:hover {
      background-color: rgba(0, 123, 255, 0.1);
      box-shadow: 0 4px 10px rgba(0, 123, 255, 0.2);
    }

    .icon-button svg {
      width: 24px;
      height: 24px;
      fill: #ccc;
    }

    .overlay {
      position: absolute;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.7);
      color: #fff;
      display: none;
      flex-direction: column;
      justify-content: flex-start;
      align-items: flex-start;
      padding: 30px;
      font-size: 18px;
      text-align: right;
      z-index: 20;
      border-radius: 8px;
      overflow-y: auto;
      overscroll-behavior: contain; /* Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø³Ú©Ø±ÙˆÙ„ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ */
    }

    .overlay h2 {
      width: 100%;
      text-align: center;
      margin-bottom: 20px;
      font-size: 24px;
    }

    .overlay p {
      margin: 8px 0;
      line-height: 1.8;
    }

    .extra-guide {
      margin-top: 25px;
      padding-top: 15px;
      border-top: 1px solid rgba(255, 255, 255, 0.3);
    }

    .extra-guide p {
      font-size: 16px;
      line-height: 2;
    }

    .close-button {
      position: absolute;
      top: 12px;
      left: 12px;
      background: transparent;
      border: none;
      color: white;
      font-size: 26px;
      cursor: pointer;
      padding: 10px; /* Ø§ÙØ²Ø§ÛŒØ´ Ù†Ø§Ø­ÛŒÙ‡ Ú©Ù„ÛŒÚ© Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ */
    }

    #loader {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: white;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 100;
      flex-direction: column;
      gap: 16px;
      border-radius: 8px;
    }

    .loader-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #007bff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    #backgroundPanel {
      justify-content: flex-start;
      padding-top: 60px;
    }

    #backgroundPanel h3 {
      margin-bottom: 10px;
      font-size: 18px;
      color: #eee;
    }

    #backgroundPanel label {
      color: #eee;
      margin-left: 10px;
    }

    #backgroundPanel input[type="color"] {
      width: 50px;
      height: 30px;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
    }

    #backgroundPanel button:not(.close-button) {
      background: #007bff;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
      margin-top: 10px;
      min-width: 120px; /* Ø­Ø¯Ø§Ù‚Ù„ Ø¹Ø±Ø¶ Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ */
    }

    #backgroundPanel button:not(.close-button):hover {
      background: #0056b3;
    }

    .color-option {
      width: 40px;
      height: 40px;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .color-option:hover {
      transform: scale(1.1);
    }

    .checkbox-container {
      display: flex;
      align-items: center;
      margin: 15px 0;
    }

    .checkbox-container input {
      margin-left: 10px;
    }

    /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù¾Ù†Ù„ Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ */
    #sharePanel {
      justify-content: flex-start;
      padding-top: 60px;
    }

    #sharePanel h3 {
      margin-bottom: 15px;
      font-size: 18px;
      color: #eee;
    }

    .share-option {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: 12px 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      margin-bottom: 10px;
      width: 100%;
      text-align: right;
      font-family: sans-serif;
      -webkit-tap-highlight-color: transparent;
    }

    .share-option:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .share-option svg {
      margin-left: 8px;
      vertical-align: middle;
    }

    #shareUrl, #shareIframe, #shareEmbed {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
      padding: 10px;
      border-radius: 4px;
      width: 100%;
      margin-top: 10px;
      direction: ltr;
      text-align: left;
      font-family: monospace;
      font-size: 14px;
      overflow-x: auto;
    }

    .copy-message {
      color: #4CAF50;
      font-size: 14px;
      margin-top: 5px;
      text-align: center;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .copy-message.show {
      opacity: 1;
    }

    /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ ÙˆØ§Ù‚Ø¹ÛŒØª Ø§ÙØ²ÙˆØ¯Ù‡ */
    #arViewer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1000;
      display: none;
    }

    #arLoader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1001;
      color: white;
    }

    .ar-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255, 255, 255, 0.3);
      border-top-color: #007bff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    #arProgressBar {
      width: 80%;
      max-width: 300px;
      height: 10px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 5px;
      overflow: hidden;
      margin-top: 15px;
    }

    #arProgress {
      height: 100%;
      width: 0%;
      background: #007bff;
      transition: width 0.3s ease;
    }

    #arErrorMessage {
      color: #ff6b6b;
      margin-top: 15px;
      text-align: center;
      display: none;
    }

    #arCloseButton {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 50%;
      z-index: 1002;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @media (max-width: 600px) {
      body {
        height: auto;
        min-height: 100vh;
        padding: 10px 0;
      }
      
      .container {
        width: 95%;
        aspect-ratio: 16 / 9;
        max-height: 80vh;
      }

      .overlay {
        font-size: 16px;
        padding: 20px;
      }

      .extra-guide p {
        font-size: 15px;
      }
      
      .control-buttons {
        bottom: 10px;
        gap: 8px;
      }
      
      .icon-button {
        width: 42px;
        height: 42px;
      }
      
      #progress-slider {
        bottom: 60px;
        margin: 0 15px;
      }
      
      #backgroundPanel button:not(.close-button) {
        width: 100%;
        padding: 12px;
      }
    }
  </style>
</head>
<body>

  <div class="container" id="model-container">
    <div id="loader">
      <div class="loader-spinner"></div>
      <p>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¯Ù„...</p>
    </div>

    <model-viewer 
      id="viewer"
      alt="Ù…Ø¯Ù„ Ø³Ù‡â€ŒØ¨Ø¹Ø¯ÛŒ"
      auto-rotate 
      camera-controls
      shadow-intensity="1"
      exposure="1"
      autoplay
      interaction-prompt="none" <!-- ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† prompt ØªØ¹Ø§Ù…Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ -->
    >
    </model-viewer>

    <input type="range" id="progress-slider" min="0" max="100" value="0" class="animation-controls" />

    <div class="control-buttons" id="controls">
      <button class="icon-button animation-controls" id="animationToggle" title="ØªÙˆÙ‚Ù Ø§Ù†ÛŒÙ…ÛŒØ´Ù†">
        <svg id="playIcon" viewBox="0 0 24 24" style="display: none;"><path d="M8 5v14l11-7z"/></svg>
        <svg id="pauseIcon" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
      </button>

      <button class="icon-button" id="rotateToggle" title="ØªÙˆÙ‚Ù Ú†Ø±Ø®Ø´ Ø®ÙˆØ¯Ú©Ø§Ø±">
        <svg id="rotateOnIcon" viewBox="0 0 24 24"><path d="M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z"/></svg>
        <svg id="rotateOffIcon" viewBox="0 0 24 24" style="display: none;"><path d="M12 7.77L18.39 18H5.61L12 7.77M12 4L2 20h20L12 4z"/></svg>
      </button>

      <button class="icon-button" onclick="toggleFullscreen()" title="ØªÙ…Ø§Ù…â€ŒØµÙØ­Ù‡">
        <svg viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm0-4h2V7h3V5H7v5zm10 4h2v5h-5v-2h3v-3zm0-4h3V7h-3V5h5v5z"/></svg>
      </button>

      <button class="icon-button" onclick="openBackgroundPanel()" title="ØªØºÛŒÛŒØ± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡">
        <svg viewBox="0 0 24 24"><path d="M12 22C6.49 22 2 17.51 2 12S6.49 2 12 2s10 4.49 10 10-4.49 10-10 10zm0-18c-4.41 0-8 3.59-8 8s3.59 8 8 8 8-3.59 8-8-3.59-8-8-8zm0 14c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z"/></svg>
      </button>

      <button class="icon-button" onclick="openSharePanel()" title="Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù…Ø¯Ù„">
        <svg viewBox="0 0 24 24"><path d="M18 16c-.8 0-1.5.4-2 1l-8-4.7c0-.1.1-.2.1-.3s0-.2-.1-.3L16 7c.5.6 1.2 1 2 1 1.7 0 3-1.3 3-3s-1.3-3-3-3-3 1.3-3 3c0 .1 0 .2.1.3L8 9.7C7.5 9.1 6.8 9 6 9c-1.7 0-3 1.3-3 3s1.3 3 3 3c.8 0 1.5-.4 2-1l8 4.7c0 .1-.1.2-.1.3 0 1.7 1.3 3 3 3s3-1.3 3-3-1.3-3-3-3z"/></svg>
      </button>

      <button class="icon-button" onclick="toggleARView()" title="Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø± ÙˆØ§Ù‚Ø¹ÛŒØª Ø§ÙØ²ÙˆØ¯Ù‡">
        <svg viewBox="0 0 24 24"><path d="M3 5v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2zm16 14H5V5h14v14z"/><path d="M11 7h2v2h-2zm0 4h2v2h-2zm0 4h2v2h-2zm-4-8h2v2H7zm0 4h2v2H7zm0 4h2v2H7zm8-8h2v2h-2zm0 4h2v2h-2zm0 4h2v2h-2z"/></svg>
      </button>

      <button class="icon-button" onclick="toggleHelp()" title="Ø±Ø§Ù‡Ù†Ù…Ø§">
        <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm1.07-7.75-.9.92C12.45 13.9 12 14.5 12 16h-2v-.5c0-1 .45-1.8 1.17-2.5l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/></svg>
      </button>
    </div>
	
    <div id="helpOverlay" class="overlay">
      <button class="close-button" onclick="toggleHelp()">Ã—</button>
      <h2>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡</h2>
      <p>ğŸ”„ <strong>Ú†Ø±Ø®Ø´ Ù…Ø¯Ù„:</strong> Ú©Ù„ÛŒÚ© Ú†Ù¾ Ùˆ Ú©Ø´ÛŒØ¯Ù†ØŒ ÛŒØ§ Ú©Ø´ÛŒØ¯Ù† Ø¨Ø§ ÛŒÚ© Ø§Ù†Ú¯Ø´Øª Ø±ÙˆÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„</p>
      <p>ğŸ” <strong>Ø¨Ø²Ø±Ú¯Ù†Ù…Ø§ÛŒÛŒ:</strong>  Ø§Ø³Ú©Ø±ÙˆÙ„ Ù…Ø§ÙˆØ³ ÛŒØ§ Ù†ÛŒØ´Ú¯ÙˆÙ† (Pinch)</p>
      <p>â†”ï¸ <strong>Ø¬Ø§Ø¨Ø¬Ø§ÛŒÛŒ:</strong> Ú©Ù„ÛŒÚ© Ø±Ø§Ø³Øª Ùˆ Ú©Ø´ÛŒØ¯Ù†ØŒ ÛŒØ§ Ø¯Ùˆ Ø§Ù†Ú¯Ø´Øª Ø±ÙˆÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„</p>
      <p>â–¶ï¸ <strong>Ú©Ù†ØªØ±Ù„ Ø§Ù†ÛŒÙ…ÛŒØ´Ù†:</strong> Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¯Ú©Ù…Ù‡ Ø´Ø±ÙˆØ¹/ØªÙˆÙ‚Ù Ø¨Ø±Ø§ÛŒ Ú©Ù†ØªØ±Ù„ Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ù…Ø¯Ù„</p>
      <p>ğŸ”„ <strong>Ú†Ø±Ø®Ø´ Ø®ÙˆØ¯Ú©Ø§Ø±:</strong> Ø¯Ú©Ù…Ù‡ Ú©Ù†ØªØ±Ù„ Ú†Ø±Ø®Ø´ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø±Ø§ÛŒ ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ú†Ø±Ø®Ø´ Ù…Ø¯Ù„</p>
      <p>ğŸ•¶ï¸ <strong>ÙˆØ§Ù‚Ø¹ÛŒØª Ø§ÙØ²ÙˆØ¯Ù‡:</strong> Ø¯Ú©Ù…Ù‡ AR Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù…Ø¯Ù„ Ø¯Ø± Ù…Ø­ÛŒØ· ÙˆØ§Ù‚Ø¹ÛŒ</p>
      <div class="extra-guide">
        <p>ğŸ® <strong>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú©Ø§Ù…Ù„ ØªØ¹Ø§Ù…Ù„ Ø¨Ø§ Ù…Ø¯Ù„:</strong></p>
        <p>ğŸ” <strong>Ú†Ø±Ø®Ø´ Ø¯ÙˆØ±Ø¨ÛŒÙ†:</strong> Ú©Ø´ÛŒØ¯Ù† ÛŒÚ© Ø§Ù†Ú¯Ø´Øª (Ù„Ù…Ø³ÛŒ) ÛŒØ§ Ú©Ù„ÛŒÚ© Ú†Ù¾ Ù…Ø§ÙˆØ³ Ùˆ Ø­Ø±Ú©Øª</p>
        <p>â†”ï¸ <strong>Ø¬Ø§Ø¨Ø¬Ø§ÛŒÛŒ:</strong> Ú©Ø´ÛŒØ¯Ù† Ø¯Ùˆ Ø§Ù†Ú¯Ø´Øª ÛŒØ§ Ú©Ù„ÛŒÚ© Ø±Ø§Ø³Øª Ù…Ø§ÙˆØ³ Ùˆ Ø­Ø±Ú©Øª</p>
        <p>ğŸ” <strong>Ú©ÙˆÚ†Ú©â€ŒÙ†Ù…Ø§ÛŒÛŒ:</strong> Ø¯ÙˆØ¨Ø§Ø± Ø¶Ø±Ø¨Ù‡ Ø±ÙˆÛŒ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ ÛŒØ§ Ø¯ÙˆØ¨Ø§Ø± Ú©Ù„ÛŒÚ©</p>
        <p>ğŸ”„ <strong>Ø²ÙˆÙ…:</strong> Ú†Ø±Ø® ØºÙ„ØªÚ© ÛŒØ§ Ù†ÛŒØ´Ú¯ÙˆÙ†</p>
        <p>â¯ï¸ <strong>Ø§Ù†ÛŒÙ…ÛŒØ´Ù†:</strong> Ø¯Ú©Ù…Ù‡ Ú©Ù†ØªØ±Ù„ Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ù¾Ø§ÛŒÛŒÙ†</p>
        <p>ğŸ¨ <strong>ØªØºÛŒÛŒØ± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡:</strong> Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¯Ú©Ù…Ù‡ ØªØºÛŒÛŒØ± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ù†Ú¯ ÛŒØ§ ØªØµÙˆÛŒØ± Ø¯Ù„Ø®ÙˆØ§Ù‡</p>
        <p>ğŸ”„ <strong>Ú†Ø±Ø®Ø´ Ø®ÙˆØ¯Ú©Ø§Ø±:</strong> Ø¯Ú©Ù…Ù‡ Ú†Ø±Ø®Ø´ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø±Ø§ÛŒ Ù…ØªÙˆÙ‚Ù Ú©Ø±Ø¯Ù† ÛŒØ§ Ø´Ø±ÙˆØ¹ Ú†Ø±Ø®Ø´ Ù…Ø¯Ù„</p>
        <p>ğŸ’¾ <strong>Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª:</strong> ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù…Ø¯Ù„ Ø¨Ù‡ ØµÙˆØ±Øª Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯</p>
        <p>ğŸ•¶ï¸ <strong>ÙˆØ§Ù‚Ø¹ÛŒØª Ø§ÙØ²ÙˆØ¯Ù‡:</strong> Ù…Ø¯Ù„ Ø±Ø§ Ø±ÙˆÛŒ Ù…Ú©Ø¹Ø¨ Ú†Ø§Ù¾ Ø´Ø¯Ù‡ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ù†ÛŒØ¯</p>
      </div>
    </div>

    <div id="backgroundPanel" class="overlay" style="display: none;">
      <button class="close-button" onclick="closeBackgroundPanel()">Ã—</button>
      <h2>ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡</h2>
      
      <div class="checkbox-container">
        <input type="radio" id="bgModeDefault" name="bgMode" value="default" checked>
        <label for="bgModeDefault">Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ (Ù…ØªÙ†Ø§Ø³Ø¨ Ø¨Ø§ Ù…Ø¯Ù„)</label>
      </div>
      
      <div class="checkbox-container">
        <input type="radio" id="bgModeGlobal" name="bgMode" value="global">
        <label for="bgModeGlobal">Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø³Ø±Ø§Ø³Ø±ÛŒ (Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ù‡ Ù…Ø¯Ù„â€ŒÙ‡Ø§)</label>
      </div>
      
      <div class="checkbox-container">
        <input type="radio" id="bgModeCustom" name="bgMode" value="custom">
        <label for="bgModeCustom">Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø³ÙØ§Ø±Ø´ÛŒ (ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ù…Ø¯Ù„)</label>
      </div>
      
      <div id="globalBgSettings" style="margin: 20px 0; display: none;">
        <h3>ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø³Ø±Ø§Ø³Ø±ÛŒ:</h3>
        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
          <button onclick="setGlobalBackgroundColor('#ffffff')" class="color-option" style="background: #ffffff;" title="Ø³ÙÛŒØ¯"></button>
          <button onclick="setGlobalBackgroundColor('#f8f8f8')" class="color-option" style="background: #f8f8f8;" title="Ø®Ø§Ú©Ø³ØªØ±ÛŒ Ø±ÙˆØ´Ù†"></button>
          <button onclick="setGlobalBackgroundColor('#000000')" class="color-option" style="background: #000000;" title="Ù…Ø´Ú©ÛŒ"></button>
          <button onclick="setGlobalBackgroundColor('#1e88e5')" class="color-option" style="background: #1e88e5;" title="Ø¢Ø¨ÛŒ"></button>
          <button onclick="setGlobalBackgroundColor('#e53935')" class="color-option" style="background: #e53935;" title="Ù‚Ø±Ù…Ø²"></button>
          <button onclick="setGlobalBackgroundColor('#43a047')" class="color-option" style="background: #43a047;" title="Ø³Ø¨Ø²"></button>
          <button onclick="setGlobalBackgroundColor('#ffeb3b')" class="color-option" style="background: #ffeb3b;" title="Ø²Ø±Ø¯"></button>
          <button onclick="setGlobalBackgroundColor('#7b1fa2')" class="color-option" style="background: #7b1fa2;" title="Ø¨Ù†ÙØ´"></button>
        </div>
        <div style="margin-top: 15px;">
          <label for="globalCustomColor">Ø±Ù†Ú¯ Ø³ÙØ§Ø±Ø´ÛŒ:</label>
          <input type="color" id="globalCustomColor" onchange="setGlobalCustomBackgroundColor(this.value)" style="margin-right: 10px;">
        </div>
        
        <div style="margin: 20px 0;">
          <h3>ØªØµÙˆÛŒØ± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø³Ø±Ø§Ø³Ø±ÛŒ:</h3>
          <input type="file" id="globalBgImageUpload" accept="image/*" style="display: none;" onchange="handleGlobalBackgroundImageUpload(this.files)">
          <button onclick="document.getElementById('globalBgImageUpload').click()" style="background: #b0b0b0; border: 1px dashed #ccc; padding: 10px 15px; border-radius: 4px; cursor: pointer;">
            Ø§Ù†ØªØ®Ø§Ø¨ ØªØµÙˆÛŒØ± Ø³Ø±Ø§Ø³Ø±ÛŒ
          </button>
          <button onclick="removeGlobalBackgroundImage()" style="background: #b0b0b0; border: 1px solid #ccc; padding: 10px 15px; border-radius: 4px; cursor: pointer; margin-right: 10px;">
            Ø­Ø°Ù ØªØµÙˆÛŒØ± Ø³Ø±Ø§Ø³Ø±ÛŒ
          </button>
          <p style="font-size: 14px; color: #ccc; margin-top: 10px;">ØªÙˆØ¬Ù‡: Ø§ÛŒÙ† ØªØµÙˆÛŒØ± Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ù‡ Ù…Ø¯Ù„â€ŒÙ‡Ø§ Ø§Ø¹Ù…Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>
        </div>
      </div>
      
      <div id="customBgSettings" style="margin: 20px 0; display: none;">
        <h3>ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø³ÙØ§Ø±Ø´ÛŒ:</h3>
        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
          <button onclick="setCustomBackgroundColor('#ffffff')" class="color-option" style="background: #ffffff;" title="Ø³ÙÛŒØ¯"></button>
          <button onclick="setCustomBackgroundColor('#f8f8f8')" class="color-option" style="background: #f8f8f8;" title="Ø®Ø§Ú©Ø³ØªØ±ÛŒ Ø±ÙˆØ´Ù†"></button>
          <button onclick="setCustomBackgroundColor('#000000')" class="color-option" style="background: #000000;" title="Ù…Ø´Ú©ÛŒ"></button>
          <button onclick="setCustomBackgroundColor('#1e88e5')" class="color-option" style="background: #1e88e5;" title="Ø¢Ø¨ÛŒ"></button>
          <button onclick="setCustomBackgroundColor('#e53935')" class="color-option" style="background: #e53935;" title="Ù‚Ø±Ù…Ø²"></button>
          <button onclick="setCustomBackgroundColor('#43a047')" class="color-option" style="background: #43a047;" title="Ø³Ø¨Ø²"></button>
          <button onclick="setCustomBackgroundColor('#ffeb3b')" class="color-option" style="background: #ffeb3b;" title="Ø²Ø±Ø¯"></button>
          <button onclick="setCustomBackgroundColor('#7b1fa2')" class="color-option" style="background: #7b1fa2;" title="Ø¨Ù†ÙØ´"></button>
        </div>
        <div style="margin-top: 15px;">
          <label for="customColor">Ø±Ù†Ú¯ Ø³ÙØ§Ø±Ø´ÛŒ:</label>
          <input type="color" id="customColor" onchange="setCustomBackgroundColor(this.value)" style="margin-right: 10px;">
        </div>
        
        <div style="margin: 20px 0;">
          <h3>ØªØµÙˆÛŒØ± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø³ÙØ§Ø±Ø´ÛŒ:</h3>
          <input type="file" id="bgImageUpload" accept="image/*" style="display: none;" onchange="handleBackgroundImageUpload(this.files)">
          <button onclick="document.getElementById('bgImageUpload').click()" style="background: #b0b0b0; border: 1px dashed #ccc; padding: 10px 15px; border-radius: 4px; cursor: pointer;">
            Ø§Ù†ØªØ®Ø§Ø¨ ØªØµÙˆÛŒØ± Ø³ÙØ§Ø±Ø´ÛŒ
          </button>
          <button onclick="removeCustomBackgroundImage()" style="background: #b0b0b0; border: 1px solid #ccc; padding: 10px 15px; border-radius: 4px; cursor: pointer; margin-right: 10px;">
            Ø­Ø°Ù ØªØµÙˆÛŒØ± Ø³ÙØ§Ø±Ø´ÛŒ
          </button>
          <p style="font-size: 14px; color: #ccc; margin-top: 10px;">ØªÙˆØ¬Ù‡: Ø§ÛŒÙ† ØªØµÙˆÛŒØ± ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ù…Ø¯Ù„ Ø§Ø¹Ù…Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>
        </div>
      </div>

      <button onclick="saveBackgroundSettings()" style="background: #4CAF50; color: white; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer; margin-top: 20px;">
        Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
      </button>
    </div>

    <!-- Ù¾Ù†Ù„ Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¬Ø¯ÛŒØ¯ -->
    <div id="sharePanel" class="overlay" style="display: none;">
      <button class="close-button" onclick="closeSharePanel()">Ã—</button>
      <h2>Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù…Ø¯Ù„</h2>
      
      <div class="share-option" onclick="copyToClipboard('shareUrl')">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>
        Ú©Ù¾ÛŒ Ù„ÛŒÙ†Ú© Ù…Ø³ØªÙ‚ÛŒÙ…
      </div>
      <textarea id="shareUrl" readonly rows="2"></textarea>
      
      <div class="share-option" onclick="copyToClipboard('shareIframe')">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/><path d="M7 12h2v5H7zm8-5h2v10h-2zm-4 7h2v3h-2zm0-4h2v2h-2z"/></svg>
        Ú©Ù¾ÛŒ Ú©Ø¯ iframe
      </div>
      <textarea id="shareIframe" readonly rows="3"></textarea>
      
      <div class="share-option" onclick="copyToClipboard('shareEmbed')">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/><path d="M8.5 15H10V9H7v1.5h1.5zM13.5 12.75L15.25 15H18l-2.25-3L18 9h-2.75l-1.75 2.25V9H11v6h1.5z"/></svg>
        Ú©Ù¾ÛŒ Ú©Ø¯ embed
      </div>
      
      <div id="copyMessage" class="copy-message">Ù…ØªÙ† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ú©Ù¾ÛŒ Ø´Ø¯!</div>
    </div>
  </div>

  <!-- Ù†Ù…Ø§ÛŒØ´Ú¯Ø± ÙˆØ§Ù‚Ø¹ÛŒØª Ø§ÙØ²ÙˆØ¯Ù‡ -->
  <div id="arViewer">
    <a-scene
      id="arScene"
      mindar-image="imageTargetSrc: targets.mind; autoStart: false;"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
      renderer="logarithmicDepthBuffer: true;"
    >
      <a-assets></a-assets>
      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <!-- ØªØ¹Ø±ÛŒÙ 6 ÙˆØ¬Ù‡ Ù…Ú©Ø¹Ø¨ Ø¨Ø§ Ù…Ø¯Ù„ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ -->
      <a-entity mindar-image-target="targetIndex: 0">
        <a-entity light="type: ambient; intensity: 0.6"></a-entity>
        <a-entity light="type: directional; intensity: 0.5" position="0 1 1"></a-entity>
        <a-entity class="model-entity" rotation="0 0 0" visible="false"></a-entity>
      </a-entity>

      <a-entity mindar-image-target="targetIndex: 1">
        <a-entity light="type: ambient; intensity: 0.6"></a-entity>
        <a-entity light="type: directional; intensity: 0.5" position="0 1 1"></a-entity>
        <a-entity class="model-entity" rotation="0 90 0" visible="false"></a-entity>
      </a-entity>

      <a-entity mindar-image-target="targetIndex: 2">
        <a-entity light="type: ambient; intensity: 0.6"></a-entity>
        <a-entity light="type: directional; intensity: 0.5" position="0 1 1"></a-entity>
        <a-entity class="model-entity" rotation="0 180 0" visible="false"></a-entity>
      </a-entity>

      <a-entity mindar-image-target="targetIndex: 3">
        <a-entity light="type: ambient; intensity: 0.6"></a-entity>
        <a-entity light="type: directional; intensity: 0.5" position="0 1 1"></a-entity>
        <a-entity class="model-entity" rotation="0 -90 0" visible="false"></a-entity>
      </a-entity>

      <a-entity mindar-image-target="targetIndex: 4">
        <a-entity light="type: ambient; intensity: 0.6"></a-entity>
        <a-entity light="type: directional; intensity: 0.5" position="0 1 1"></a-entity>
        <a-entity class="model-entity" rotation="90 0 0" visible="false"></a-entity>
      </a-entity>

      <a-entity mindar-image-target="targetIndex: 5">
        <a-entity light="type: ambient; intensity: 0.6"></a-entity>
        <a-entity light="type: directional; intensity: 0.5" position="0 1 1"></a-entity>
        <a-entity class="model-entity" rotation="-90 0 0" visible="false"></a-entity>
      </a-entity>
    </a-scene>
    <button id="arCloseButton" onclick="closeARView()">Ã—</button>
  </div>

  <div id="arLoader">
    <div class="ar-spinner"></div>
    <div id="arLoadingText">Ø¯Ø± Ø­Ø§Ù„ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ÙˆØ§Ù‚Ø¹ÛŒØª Ø§ÙØ²ÙˆØ¯Ù‡...</div>
    <div id="arProgressBar"><div id="arProgress"></div></div>
    <div id="arErrorMessage"></div>
  </div>

  <script>
    /**
     * Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ù…Ø§ÛŒØ´Ú¯Ø± Ù…Ø¯Ù„ Ø³Ù‡â€ŒØ¨Ø¹Ø¯ÛŒ Ùˆ ÙˆØ§Ù‚Ø¹ÛŒØª Ø§ÙØ²ÙˆØ¯Ù‡
     * Ø§ÛŒÙ† Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø§Ù…Ú©Ø§Ù† Ù†Ù…Ø§ÛŒØ´ Ùˆ Ú©Ù†ØªØ±Ù„ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø³Ù‡â€ŒØ¨Ø¹Ø¯ÛŒ Ø¨Ø§ ÙØ±Ù…Øª glb/usdz Ø±Ø§ ÙØ±Ø§Ù‡Ù… Ù…ÛŒâ€ŒÚ©Ù†Ø¯
     * Ùˆ Ø´Ø§Ù…Ù„ Ø§Ù…Ú©Ø§Ù†Ø§ØªÛŒ Ù…Ø§Ù†Ù†Ø¯ Ú©Ù†ØªØ±Ù„ Ø§Ù†ÛŒÙ…ÛŒØ´Ù†ØŒ ØªØºÛŒÛŒØ± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ØŒ Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù…Ø¯Ù„ Ùˆ ÙˆØ§Ù‚Ø¹ÛŒØª Ø§ÙØ²ÙˆØ¯Ù‡ Ø§Ø³Øª.
     */
    
    // Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ URL
    const urlParams = new URLSearchParams(window.location.search);
    const modelFile = urlParams.get('model') || 'danger_of_smoking_1.glb';
    const defaultBgColor = urlParams.get('bg') || '#ffffff';

    /**
     * ØªÙˆÙ„ÛŒØ¯ Ù…Ø³ÛŒØ± ÙØ§ÛŒÙ„ USDZ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ø§Ù… ÙØ§ÛŒÙ„ GLB
     * @param {string} glbPath - Ù…Ø³ÛŒØ± ÙØ§ÛŒÙ„ GLB
     * @return {string} Ù…Ø³ÛŒØ± ÙØ§ÛŒÙ„ USDZ Ù…ØªÙ†Ø§Ø¸Ø±
     */
    function getUsdzPath(glbPath) {
      return glbPath.replace('.glb', '.usdz');
    }

    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¯Ù„ Ùˆ Ø§Ø¹Ù…Ø§Ù„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
    document.addEventListener('DOMContentLoaded', () => {
      const viewer = document.getElementById('viewer');
      const usdzFile = getUsdzPath(modelFile);
      
      // ØªÙ†Ø¸ÛŒÙ… Ù…Ø¯Ù„â€ŒÙ‡Ø§
      viewer.src = modelFile;
      viewer.setAttribute('ios-src', usdzFile);
      
      // Ø§Ø¹Ù…Ø§Ù„ Ø±Ù†Ú¯ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ù¾ÛŒØ´â€ŒÙØ±Ø¶
      document.documentElement.style.setProperty('--model-bg-color', defaultBgColor);
      viewer.style.backgroundColor = defaultBgColor;
      
      // Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡
      currentModelSettings = {
        color: defaultBgColor,
        image: ''
      };
      
      // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡
      loadBackgroundSettings();
      
      // Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù†Ù…Ø§ÛŒØ´Ú¯Ø± AR
      setupARScene();
    });

    // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¬Ù‡Ø§Ù†ÛŒ
    const viewer = document.getElementById('viewer');
    const animationToggle = document.getElementById('animationToggle');
    const rotateToggle = document.getElementById('rotateToggle');
    const playIcon = document.getElementById('playIcon');
    const pauseIcon = document.getElementById('pauseIcon');
    const rotateOnIcon = document.getElementById('rotateOnIcon');
    const rotateOffIcon = document.getElementById('rotateOffIcon');
    const slider = document.getElementById('progress-slider');
    const loader = document.getElementById('loader');
    const controls = document.getElementById('controls');
    const container = document.getElementById('model-container');
    const animationControls = document.querySelectorAll('.animation-controls');
    
    // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ ÙˆØ§Ù‚Ø¹ÛŒØª Ø§ÙØ²ÙˆØ¯Ù‡
    const arViewer = document.getElementById('arViewer');
    const arLoader = document.getElementById('arLoader');
    const arLoadingText = document.getElementById('arLoadingText');
    const arProgress = document.getElementById('arProgress');
    const arErrorMessage = document.getElementById('arErrorMessage');
    const arScene = document.getElementById('arScene');
    const arCloseButton = document.getElementById('arCloseButton');
    
    let isPlaying = true;
    let isAutoRotating = true;
    let wasPlayingBeforeDrag = false;
    let isDragging = false;
    let rafId = null;
    let hideTimeout;
    let currentModelSettings = {
      color: '#ffffff',
      image: ''
    };
    let globalBackgroundSettings = {
      color: '',
      image: ''
    };
    let currentModelId = '';
    let hasAnimations = false;
    let currentBackgroundMode = 'default'; // 'default', 'global', 'custom'
    
    // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ AR
    let isARActive = false;
    let isModelLoadedInAR = false;
    let modelEntitiesAR = [];

    // ØªÙ†Ø¸ÛŒÙ… Ø­Ø§Ù„Øª Ø§ÙˆÙ„ÛŒÙ‡ Ø¢ÛŒÚ©ÙˆÙ†â€ŒÙ‡Ø§
    pauseIcon.style.display = 'block';
    playIcon.style.display = 'none';
    rotateOnIcon.style.display = 'block';
    rotateOffIcon.style.display = 'none';

    /**
     * ØªÙˆÙ„ÛŒØ¯ Ø´Ù†Ø§Ø³Ù‡ Ù…Ù†Ø­ØµØ± Ø¨Ù‡ ÙØ±Ø¯ Ø¨Ø±Ø§ÛŒ Ù…Ø¯Ù„ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¢Ø¯Ø±Ø³ ÙØ§ÛŒÙ„
     * @return {string} Ø´Ù†Ø§Ø³Ù‡ Ù…Ù†Ø­ØµØ± Ø¨Ù‡ ÙØ±Ø¯ Ù…Ø¯Ù„
     */
    function getModelId() {
      const modelSrc = viewer.getAttribute('src');
      return modelSrc ? modelSrc : 'default-model';
    }

    /**
     * Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø§Ø² localStorage
     * Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù…Ø¯Ù„ ÙØ¹Ù„ÛŒ Ùˆ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³Ø±Ø§Ø³Ø±ÛŒ Ø±Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
     */
    function loadBackgroundSettings() {
      currentModelId = getModelId();
      
      // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³Ø±Ø§Ø³Ø±ÛŒ
      const savedGlobalSettings = localStorage.getItem('modelViewerGlobalBackground');
      if (savedGlobalSettings) {
        globalBackgroundSettings = JSON.parse(savedGlobalSettings);
      }
      
      // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³ÙØ§Ø±Ø´ÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø¯Ù„ ÙØ¹Ù„ÛŒ
      const savedSettings = localStorage.getItem(`modelViewerBackground_${currentModelId}`);
      if (savedSettings) {
        currentModelSettings = JSON.parse(savedSettings);
      }
      
      // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø­Ø§Ù„Øª Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡
      const savedBgMode = localStorage.getItem('modelViewerBackgroundMode');
      currentBackgroundMode = savedBgMode || 'default';
      
      // Ø§Ø¹Ù…Ø§Ù„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø­Ø§Ù„Øª Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
      applyBackgroundSettings();
    }

    /**
     * Ø§Ø¹Ù…Ø§Ù„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø­Ø§Ù„Øª Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
     * Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø±Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø­Ø§Ù„Øª ÙØ¹Ù„ÛŒ (Ù¾ÛŒØ´â€ŒÙØ±Ø¶ØŒ Ø³Ø±Ø§Ø³Ø±ÛŒ ÛŒØ§ Ø³ÙØ§Ø±Ø´ÛŒ) Ø§Ø¹Ù…Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
     */
    function applyBackgroundSettings() {
      if (currentBackgroundMode === 'global') {
        // Ø­Ø§Ù„Øª Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø³Ø±Ø§Ø³Ø±ÛŒ
        if (globalBackgroundSettings.image) {
          viewer.style.backgroundImage = `url(${globalBackgroundSettings.image})`;
          viewer.style.backgroundSize = 'cover';
          viewer.style.backgroundColor = '';
        } else if (globalBackgroundSettings.color) {
          viewer.style.backgroundColor = globalBackgroundSettings.color;
          viewer.style.backgroundImage = 'none';
        } else {
          // Ø§Ú¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³Ø±Ø§Ø³Ø±ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯ØŒ Ø§Ø² Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
          viewer.style.backgroundColor = defaultBgColor;
          viewer.style.backgroundImage = 'none';
        }
      } else if (currentBackgroundMode === 'custom') {
        // Ø­Ø§Ù„Øª Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø³ÙØ§Ø±Ø´ÛŒ
        if (currentModelSettings.image) {
          viewer.style.backgroundImage = `url(${currentModelSettings.image})`;
          viewer.style.backgroundSize = 'cover';
          viewer.style.backgroundColor = '';
        } else {
          viewer.style.backgroundColor = currentModelSettings.color || defaultBgColor;
          viewer.style.backgroundImage = 'none';
        }
      } else {
        // Ø­Ø§Ù„Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ (Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªÙ†Ø¸ÛŒÙ…Ø§Øª URL)
        viewer.style.backgroundColor = defaultBgColor;
        viewer.style.backgroundImage = 'none';
      }
    }

    /**
     * Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø¯Ø± localStorage
     * Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ ØªÙ†Ø¸ÛŒÙ…Ø§Øª ÙØ¹Ù„ÛŒ Ø±Ø§ Ø¯Ø± localStorage Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
     */
    function saveBackgroundSettings() {
      currentModelId = getModelId();
      
      // Ø°Ø®ÛŒØ±Ù‡ Ø­Ø§Ù„Øª Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡
      localStorage.setItem('modelViewerBackgroundMode', currentBackgroundMode);
      
      // Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³Ø±Ø§Ø³Ø±ÛŒ
      localStorage.setItem('modelViewerGlobalBackground', JSON.stringify(globalBackgroundSettings));
      
      // Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³ÙØ§Ø±Ø´ÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø¯Ù„ ÙØ¹Ù„ÛŒ
      localStorage.setItem(`modelViewerBackground_${currentModelId}`, JSON.stringify(currentModelSettings));
      
      // Ø§Ø¹Ù…Ø§Ù„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¬Ø¯ÛŒØ¯
      applyBackgroundSettings();
      
      closeBackgroundPanel();
    }

    /**
     * Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø¨Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶
     * Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø±Ø§ Ø¨Ù‡ Ø­Ø§Ù„Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø§Ø²Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯
     */
    function resetToDefaultBackground() {
      viewer.style.backgroundColor = defaultBgColor;
      viewer.style.backgroundImage = '';
      currentModelSettings = {
        color: defaultBgColor,
        image: ''
      };
      currentBackgroundMode = 'default';
    }

    /**
     * Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø¯Ø± Ù…Ø¯Ù„
     * @return {Promise<boolean>} ÙˆØ¬ÙˆØ¯ ÛŒØ§ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø¯Ø± Ù…Ø¯Ù„
     */
    function checkForAnimations() {
      return new Promise((resolve) => {
        if (viewer.availableAnimations && viewer.availableAnimations.length > 0) {
          resolve(true);
        } else {
          setTimeout(() => {
            const hasDuration = viewer.duration > 0;
            resolve(hasDuration);
          }, 500);
        }
      });
    }

    /**
     * ØªÙ†Ø¸ÛŒÙ… Ù†Ù…Ø§ÛŒØ´ Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆØ¬ÙˆØ¯ Ø§Ù†ÛŒÙ…ÛŒØ´Ù†
     * @param {boolean} hasAnim - Ø¢ÛŒØ§ Ù…Ø¯Ù„ Ø¯Ø§Ø±Ø§ÛŒ Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø§Ø³Øª ÛŒØ§ Ø®ÛŒØ±
     */
    function setupAnimationControls(hasAnim) {
      hasAnimations = hasAnim;
      
      if (hasAnimations) {
        animationControls.forEach(control => {
          control.classList.remove('hidden');
        });
        
        if (isPlaying) {
          startAnimationLoop();
        }
      } else {
        animationControls.forEach(control => {
          control.classList.add('hidden');
        });
        
        stopAnimationLoop();
      }
    }

    // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ù…Ø¯Ù„
    viewer.addEventListener('load', async () => {
      loader.style.display = 'none';
      
      const hasAnim = await checkForAnimations();
      setupAnimationControls(hasAnim);
    });

    viewer.addEventListener('ar-status', (event) => {
      if (event.detail.status === 'session-started') {
        if (!document.fullscreenElement) {
          document.documentElement.requestFullscreen().catch(err => {
            console.log("Ø®Ø·Ø§ Ø¯Ø± ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø­Ø§Ù„Øª ØªÙ…Ø§Ù…â€ŒØµÙØ­Ù‡:", err);
          });
        }
      }
    });

    /**
     * Ù…Ø¯ÛŒØ±ÛŒØª Ø±ÙˆÛŒØ¯Ø§Ø¯ Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Ú©Ù†ØªØ±Ù„ Ø§Ù†ÛŒÙ…ÛŒØ´Ù†
     */
    animationToggle.addEventListener('click', () => {
      if (!hasAnimations) return;
      
      if (isPlaying) {
        viewer.pause();
        pauseIcon.style.display = 'none';
        playIcon.style.display = 'block';
        animationToggle.setAttribute('title', 'Ø´Ø±ÙˆØ¹ Ø§Ù†ÛŒÙ…ÛŒØ´Ù†');
        stopAnimationLoop();
      } else {
        viewer.play();
        pauseIcon.style.display = 'block';
        playIcon.style.display = 'none';
        animationToggle.setAttribute('title', 'ØªÙˆÙ‚Ù Ø§Ù†ÛŒÙ…ÛŒØ´Ù†');
        startAnimationLoop();
      }
      isPlaying = !isPlaying;
      showControls();
    });

    /**
     * Ù…Ø¯ÛŒØ±ÛŒØª Ø±ÙˆÛŒØ¯Ø§Ø¯ Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Ú©Ù†ØªØ±Ù„ Ú†Ø±Ø®Ø´ Ø®ÙˆØ¯Ú©Ø§Ø±
     */
    rotateToggle.addEventListener('click', () => {
      if (isAutoRotating) {
        viewer.autoRotate = false;
        rotateOnIcon.style.display = 'none';
        rotateOffIcon.style.display = 'block';
        rotateToggle.setAttribute('title', 'Ø´Ø±ÙˆØ¹ Ú†Ø±Ø®Ø´ Ø®ÙˆØ¯Ú©Ø§Ø±');
      } else {
        viewer.autoRotate = true;
        rotateOnIcon.style.display = 'block';
        rotateOffIcon.style.display = 'none';
        rotateToggle.setAttribute('title', 'ØªÙˆÙ‚Ù Ú†Ø±Ø®Ø´ Ø®ÙˆØ¯Ú©Ø§Ø±');
      }
      isAutoRotating = !isAutoRotating;
      showControls();
    });

    /**
     * Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø§Ø³Ù„Ø§ÛŒØ¯Ø± Ù¾ÛŒØ´Ø±ÙØª Ø§Ù†ÛŒÙ…ÛŒØ´Ù†
     */
    function updateSlider() {
      if (!hasAnimations) return;
      
      const duration = viewer.duration;
      const currentTime = viewer.currentTime;
      if (duration && !isDragging) {
        slider.value = (currentTime / duration) * 100;
      }
      rafId = requestAnimationFrame(updateSlider);
    }

    /**
     * Ø´Ø±ÙˆØ¹ Ø­Ù„Ù‚Ù‡ Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø¨Ø±Ø§ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø³Ù„Ø§ÛŒØ¯Ø±
     */
    function startAnimationLoop() {
      if (!hasAnimations) return;
      
      cancelAnimationFrame(rafId);
      updateSlider();
    }

    /**
     * ØªÙˆÙ‚Ù Ø­Ù„Ù‚Ù‡ Ø§Ù†ÛŒÙ…ÛŒØ´Ù†
     */
    function stopAnimationLoop() {
      cancelAnimationFrame(rafId);
    }

    // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø§Ø³Ù„Ø§ÛŒØ¯Ø± Ù¾ÛŒØ´Ø±ÙØª Ø§Ù†ÛŒÙ…ÛŒØ´Ù†
    slider.addEventListener('pointerdown', () => {
      if (!hasAnimations) return;
      
      isDragging = true;
      wasPlayingBeforeDrag = isPlaying;
      if (isPlaying) {
        viewer.pause();
        stopAnimationLoop();
      }
      showControls();
    });

    slider.addEventListener('input', () => {
      if (!hasAnimations) return;
      
      const duration = viewer.duration;
      if (duration) {
        viewer.currentTime = (slider.value / 100) * duration;
      }
    });

    slider.addEventListener('pointerup', () => {
      if (!hasAnimations) return;
      
      if (wasPlayingBeforeDrag) {
        viewer.play();
        startAnimationLoop();
      }
      isDragging = false;
      showControls();
    });

    /**
     * ØªØºÛŒÛŒØ± Ø­Ø§Ù„Øª ØªÙ…Ø§Ù…â€ŒØµÙØ­Ù‡
     */
    function toggleFullscreen() {
      const container = document.querySelector('.container');
      if (!document.fullscreenElement) {
        container.requestFullscreen().catch(err => {
          alert(`ØªÙ…Ø§Ù…â€ŒØµÙØ­Ù‡ Ù†Ø´Ø¯: ${err.message}`);
        });
      } else {
        document.exitFullscreen();
      }
      showControls();
    }

    /**
     * Ù†Ù…Ø§ÛŒØ´/Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ù¾Ù†Ù„ Ø±Ø§Ù‡Ù†Ù…Ø§
     */
    function toggleHelp() {
      const overlay = document.getElementById('helpOverlay');
      overlay.style.display = overlay.style.display === 'flex' ? 'none' : 'flex';
      showControls();
    }

    /**
     * Ù†Ù…Ø§ÛŒØ´ Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ù…ÙˆÙ‚Øª
     */
    function showControls() {
      controls.classList.remove('hidden');
      if (hasAnimations) {
        slider.classList.remove('hidden');
      }
      clearTimeout(hideTimeout);
      hideTimeout = setTimeout(() => {
        controls.classList.add('hidden');
        if (hasAnimations) {
          slider.classList.add('hidden');
        }
      }, 3000);
    }

    /**
     * Ù†Ù…Ø§ÛŒØ´ Ù¾Ù†Ù„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡
     */
    function openBackgroundPanel() {
      const panel = document.getElementById('backgroundPanel');
      panel.style.display = 'flex';
      
      // ØªÙ†Ø¸ÛŒÙ… Ø­Ø§Ù„Øª Ø±Ø§Ø¯ÛŒÙˆ Ø¨Ø§ØªÙ†â€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø­Ø§Ù„Øª ÙØ¹Ù„ÛŒ
      document.getElementById(`bgMode${currentBackgroundMode.charAt(0).toUpperCase() + currentBackgroundMode.slice(1)}`).checked = true;
      
      // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡
      document.getElementById('globalBgSettings').style.display = currentBackgroundMode === 'global' ? 'block' : 'none';
      document.getElementById('customBgSettings').style.display = currentBackgroundMode === 'custom' ? 'block' : 'none';
      
      showControls();
    }

    /**
     * Ø¨Ø³ØªÙ† Ù¾Ù†Ù„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡
     */
    function closeBackgroundPanel() {
      document.getElementById('backgroundPanel').style.display = 'none';
      showControls();
    }

    /**
     * ØªØºÛŒÛŒØ± Ø­Ø§Ù„Øª Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡
     * @param {string} mode - Ø­Ø§Ù„Øª Ø¬Ø¯ÛŒØ¯ ('default', 'global', 'custom')
     */
    function changeBackgroundMode(mode) {
      currentBackgroundMode = mode;
      
      // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡
      document.getElementById('globalBgSettings').style.display = mode === 'global' ? 'block' : 'none';
      document.getElementById('customBgSettings').style.display = mode === 'custom' ? 'block' : 'none';
      
      // Ø§Ø¹Ù…Ø§Ù„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¬Ø¯ÛŒØ¯
      applyBackgroundSettings();
    }

    /**
     * ØªÙ†Ø¸ÛŒÙ… Ø±Ù†Ú¯ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø³Ø±Ø§Ø³Ø±ÛŒ
     * @param {string} color - Ø±Ù†Ú¯ Ø¬Ø¯ÛŒØ¯ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡
     */
    function setGlobalBackgroundColor(color) {
      globalBackgroundSettings.color = color;
      globalBackgroundSettings.image = '';
      if (currentBackgroundMode === 'global') {
        viewer.style.backgroundColor = color;
        viewer.style.backgroundImage = 'none';
      }
    }

    /**
     * ØªÙ†Ø¸ÛŒÙ… Ø±Ù†Ú¯ Ø³ÙØ§Ø±Ø´ÛŒ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø³Ø±Ø§Ø³Ø±ÛŒ
     * @param {string} color - Ø±Ù†Ú¯ Ø¬Ø¯ÛŒØ¯ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡
     */
    function setGlobalCustomBackgroundColor(color) {
      setGlobalBackgroundColor(color);
    }

    /**
     * Ù…Ø¯ÛŒØ±ÛŒØª Ø¢Ù¾Ù„ÙˆØ¯ ØªØµÙˆÛŒØ± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø³Ø±Ø§Ø³Ø±ÛŒ
     * @param {FileList} files - Ù„ÛŒØ³Øª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
     */
    function handleGlobalBackgroundImageUpload(files) {
      if (files && files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          globalBackgroundSettings.image = e.target.result;
          globalBackgroundSettings.color = '';
          if (currentBackgroundMode === 'global') {
            viewer.style.backgroundImage = `url(${e.target.result})`;
            viewer.style.backgroundSize = 'cover';
            viewer.style.backgroundColor = '';
          }
        };
        reader.readAsDataURL(files[0]);
      }
    }

    /**
     * Ø­Ø°Ù ØªØµÙˆÛŒØ± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø³Ø±Ø§Ø³Ø±ÛŒ
     */
    function removeGlobalBackgroundImage() {
      const urlParams = new URLSearchParams(window.location.search);
      const defaultBg = urlParams.get('bg') || '#ffffff';
      
      globalBackgroundSettings.image = '';
      globalBackgroundSettings.color = defaultBg;
      if (currentBackgroundMode === 'global') {
        viewer.style.backgroundImage = '';
        viewer.style.backgroundColor = defaultBg;
      }
    }

    /**
     * ØªÙ†Ø¸ÛŒÙ… Ø±Ù†Ú¯ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø³ÙØ§Ø±Ø´ÛŒ
     * @param {string} color - Ø±Ù†Ú¯ Ø¬Ø¯ÛŒØ¯ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡
     */
    function setCustomBackgroundColor(color) {
      currentModelSettings.color = color;
      currentModelSettings.image = '';
      if (currentBackgroundMode === 'custom') {
        viewer.style.backgroundColor = color;
        viewer.style.backgroundImage = 'none';
      }
    }

    /**
     * Ù…Ø¯ÛŒØ±ÛŒØª Ø¢Ù¾Ù„ÙˆØ¯ ØªØµÙˆÛŒØ± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø³ÙØ§Ø±Ø´ÛŒ
     * @param {FileList} files - Ù„ÛŒØ³Øª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
     */
    function handleBackgroundImageUpload(files) {
      if (files && files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          currentModelSettings.image = e.target.result;
          currentModelSettings.color = '';
          if (currentBackgroundMode === 'custom') {
            viewer.style.backgroundImage = `url(${e.target.result})`;
            viewer.style.backgroundSize = 'cover';
            viewer.style.backgroundColor = '';
          }
        };
        reader.readAsDataURL(files[0]);
      }
    }

    /**
     * Ø­Ø°Ù ØªØµÙˆÛŒØ± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø³ÙØ§Ø±Ø´ÛŒ
     */
    function removeCustomBackgroundImage() {
      const urlParams = new URLSearchParams(window.location.search);
      const defaultBg = urlParams.get('bg') || '#ffffff';
      
      currentModelSettings.image = '';
      currentModelSettings.color = defaultBg;
      if (currentBackgroundMode === 'custom') {
        viewer.style.backgroundImage = '';
        viewer.style.backgroundColor = defaultBg;
      }
    }

    /**
     * Ù†Ù…Ø§ÛŒØ´ Ù¾Ù†Ù„ Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ
     */
    function openSharePanel() {
      const panel = document.getElementById('sharePanel');
      panel.style.display = 'flex';
      
      // ØªÙˆÙ„ÛŒØ¯ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§
      const currentUrl = window.location.href;

      // Ú©Ø¯ iframe
      const iframeCode = `
        <iframe 
          src="${currentUrl}" 
          width="100%" 
          height="500px" 
          style="border: none;"
          allowfullscreen
          allow="fullscreen"
        ></iframe>
      `;

      // Ú©Ø¯ embed
      const embedCode = `
        <div style="width: 100%; height: 500px;">
          <iframe 
            src="${currentUrl}" 
            style="width: 100%; height: 100%; border: none;"
            allowfullscreen
            allow="fullscreen"
          ></iframe>
        </div>
      `;
      
      document.getElementById('shareUrl').value = currentUrl;
      document.getElementById('shareIframe').value = iframeCode;
      document.getElementById('shareEmbed').value = embedCode;
      
      showControls();
    }

    /**
     * Ø¨Ø³ØªÙ† Ù¾Ù†Ù„ Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ
     */
    function closeSharePanel() {
      document.getElementById('sharePanel').style.display = 'none';
      showControls();
    }

    /**
     * Ú©Ù¾ÛŒ Ù…ØªÙ† Ø¨Ù‡ Ú©Ù„ÛŒÙ¾â€ŒØ¨ÙˆØ±Ø¯
     * @param {string} elementId - Ø´Ù†Ø§Ø³Ù‡ Ø§Ù„Ù…Ø§Ù† Ø­Ø§ÙˆÛŒ Ù…ØªÙ† Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ
     */
    function copyToClipboard(elementId) {
      const element = document.getElementById(elementId);
      element.select();
      document.execCommand('copy');
      
      const message = document.getElementById('copyMessage');
      message.classList.add('show');
      setTimeout(() => {
        message.classList.remove('show');
      }, 2000);
    }

    /**
     * Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ ØµØ­Ù†Ù‡ ÙˆØ§Ù‚Ø¹ÛŒØª Ø§ÙØ²ÙˆØ¯Ù‡
     */
    function setupARScene() {
      modelEntitiesAR = document.querySelectorAll('#arScene .model-entity');
      
      modelEntitiesAR.forEach((modelEntity) => {
        modelEntity.setAttribute('gltf-model', `url(${modelFile})`);
        
        modelEntity.addEventListener('model-loaded', (e) => {
          const scale = calculateScaleAR(e.detail.model);
          modelEntity.setAttribute('scale', `${scale.x} ${scale.y} ${scale.z}`);
          modelEntity.setAttribute('position', '0 0 0.05');
          
          if (!isModelLoadedInAR) {
            isModelLoadedInAR = true;
            updateARProgress(100);
          }
        });
        
        modelEntity.addEventListener('model-error', (e) => {
          console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¯Ù„ AR:', e.detail);
          arErrorMessage.textContent = 'Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¯Ù„ Ø¯Ø± Ø­Ø§Ù„Øª ÙˆØ§Ù‚Ø¹ÛŒØª Ø§ÙØ²ÙˆØ¯Ù‡.';
          arErrorMessage.style.display = 'block';
          updateARProgress(100);
        });
      });
      
      // ØªÙ†Ø¸ÛŒÙ… Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ù‡Ø¯Ùâ€ŒÚ¯ÛŒØ±ÛŒ
      setupARTargetEvents();
      
      // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ
      simulateARLoading();
    }
    
    /**
     * Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ù‚ÛŒØ§Ø³ Ù…Ø¯Ù„ Ø¨Ø±Ø§ÛŒ AR
     * @param {Object} object3D - Ù…Ø¯Ù„ Ø³Ù‡â€ŒØ¨Ø¹Ø¯ÛŒ
     * @return {Object} Ù…Ù‚ÛŒØ§Ø³ Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø±Ø§ÛŒ Ù…Ø¯Ù„
     */
    function calculateScaleAR(object3D) {
      const manualScale = urlParams.get('scale');
      if (manualScale) {
        const scaleValue = parseFloat(manualScale);
        if (!isNaN(scaleValue)) {
          return {x: scaleValue, y: scaleValue, z: scaleValue};
        }
      }
      
      const bbox = new THREE.Box3().setFromObject(object3D);
      const size = bbox.getSize(new THREE.Vector3());
      const maxDim = Math.max(size.x, size.y, size.z);
      const targetSize = 0.15;
      const scale = 10 * targetSize / maxDim;
      return {x: scale, y: scale, z: scale};
    }
    
    /**
     * ØªÙ†Ø¸ÛŒÙ… Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ù‡Ø¯Ùâ€ŒÚ¯ÛŒØ±ÛŒ AR
     */
    function setupARTargetEvents() {
      document.querySelectorAll('#arScene [mindar-image-target]').forEach((target, index) => {
        target.addEventListener('targetFound', () => {
          modelEntitiesAR.forEach(m => m.setAttribute('visible', 'false'));
          const model = target.querySelector('.model-entity');
          if (model) {
            model.setAttribute('visible', 'true');
          }
        });
        target.addEventListener('targetLost', () => {
          const model = target.querySelector('.model-entity');
          if (model) model.setAttribute('visible', 'false');
        });
      });
    }
    
    /**
     * Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾ÛŒØ´Ø±ÙØª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ AR
     * @param {number} percent - Ø¯Ø±ØµØ¯ Ù¾ÛŒØ´Ø±ÙØª
     */
    function updateARProgress(percent) {
      arProgress.style.width = percent + '%';
      arLoadingText.textContent = `Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ù†Ø§Ø¨Ø¹ (${percent}%)`;
      if (percent >= 100) {
        setTimeout(() => {
          arLoader.style.display = 'none';
        }, 500);
      }
    }
    
    /**
     * Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ AR
     */
    function simulateARLoading() {
      let progress = 0;
      const interval = setInterval(() => {
        progress += 5;
        updateARProgress(progress);
        if (progress >= 90 || isModelLoadedInAR) {
          clearInterval(interval);
          if (!isModelLoadedInAR) {
            setTimeout(() => {
              if (!isModelLoadedInAR) updateARProgress(100);
            }, 2000);
          }
        }
      }, 100);
    }
    
    /**
     * Ù†Ù…Ø§ÛŒØ´/Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ù†Ù…Ø§ÛŒØ´Ú¯Ø± AR
     */
    function toggleARView() {
      if (isARActive) {
        closeARView();
      } else {
        openARView();
      }
    }
    
    /**
     * Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù†Ù…Ø§ÛŒØ´Ú¯Ø± AR
     */
    async function openARView() {
      try {
        isARActive = true;
        arViewer.style.display = 'block';
        arLoader.style.display = 'flex';
        arErrorMessage.style.display = 'none';
        arLoadingText.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ AR...';
        
        const mindarSystem = arScene.systems['mindar-image-system'];
        await mindarSystem.start();
        
        setupARTargetEvents();
        arLoader.style.display = 'none';
        arScene.querySelector('a-camera').setAttribute('look-controls', 'enabled: true');
      } catch (err) {
        console.error('Ø®Ø·Ø§ Ø¯Ø± Ø´Ø±ÙˆØ¹ AR:', err);
        arErrorMessage.textContent = 'Ø®Ø·Ø§ Ø¯Ø± Ø´Ø±ÙˆØ¹ AR. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯.';
        arErrorMessage.style.display = 'block';
        arLoadingText.textContent = 'Ø®Ø·Ø§ Ø¯Ø± Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ';
      }
    }
    
    /**
     * Ø¨Ø³ØªÙ† Ù†Ù…Ø§ÛŒØ´Ú¯Ø± AR
     */
    function closeARView() {
      const mindarSystem = arScene.systems['mindar-image-system'];
      if (mindarSystem) {
        mindarSystem.stop();
      }
      
      arViewer.style.display = 'none';
      isARActive = false;
    }

    // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ ØªØºÛŒÛŒØ± Ø­Ø§Ù„Øª Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡
    document.getElementById('bgModeDefault').addEventListener('change', () => {
      if (document.getElementById('bgModeDefault').checked) {
        changeBackgroundMode('default');
      }
    });

    document.getElementById('bgModeGlobal').addEventListener('change', () => {
      if (document.getElementById('bgModeGlobal').checked) {
        changeBackgroundMode('global');
      }
    });

    document.getElementById('bgModeCustom').addEventListener('change', () => {
      if (document.getElementById('bgModeCustom').checked) {
        changeBackgroundMode('custom');
      }
    });

    // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
    window.addEventListener('load', () => {
      loadBackgroundSettings();
      
      hideTimeout = setTimeout(() => {
        controls.classList.add('hidden');
        if (hasAnimations) {
          slider.classList.add('hidden');
        }
      }, 3000);
    });

    // Ù†Ù…Ø§ÛŒØ´ Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ Ù‡Ù†Ú¯Ø§Ù… ØªØ¹Ø§Ù…Ù„
    container.addEventListener('mousemove', showControls);
    container.addEventListener('touchmove', showControls);
    viewer.addEventListener('click', showControls);
  </script>
</body>
</html>